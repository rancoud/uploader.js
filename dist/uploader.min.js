/**
 * uploader.js (v1.0.0)
 * https://github.com/rancoud/uploader.js
 * 
 * MIT License
 * 
 * Copyright (c) 2023 Rancoud
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(){"use strict";var a="point";function n(t,e){return"string"!=typeof e?new TypeError("Invalid attribute "+t+", expect string, get "+typeof e):document.getElementById(e)||new Error("DOM element "+e+" not found")}function t(t){var e;return this.initAttributes(),null!==(e=this.verifyMandatoryDataAttributes(t))||null!==(e=this.verifyOptionalDataAttributes(t))?e:(this.initInputFile(),this.initCanvas(),this.initDivs(),this.initMask(),this.initZoom(),this.initSave(),this.initCancel(),void(null!==this.callbacks.init&&this.callbacks.init(this,"Uploader")))}function o(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1}function d(){return"function"==typeof DOMMatrix?new DOMMatrix:document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()}t.prototype.initAttributes=function(){this.img=null,this.imgSizeComputed=null,this.eventChangeInputFileListener=this.changeInputFile.bind(this),this.eventTreatImageListener=this.treatImage.bind(this),this.eventChangeInputZoomListener=this.changeInputZoomListener.bind(this),this.eventInputInputZoomListener=this.inputInputZoomListener.bind(this),this.zoomCurrent=1,this.zoomEventHasNeverFired=null,this.zoomCurrentValue=null,this.zoomLastValue=null,this.eventSaveListener=this.save.bind(this),this.eventSaveOnLoad=this.saveOnLoad.bind(this),this.eventSaveOnError=this.saveOnError.bind(this),this.eventCancelListener=this.cancel.bind(this),this.ptTopLeftMask={x:0,y:0},this.ptBottomRightMask={x:0,y:0},this.mask=null,this.maskRaw={color:null,size:null,radius:0,constraint:!0},this.inputFileObj=null,this.canvasObj=null,this.cssClassCanvasMoving="",this.scaleFactor=1.05,this.dragStart=null,this.divErrorObj=null,this.divUploadObj=null,this.divPreviewObj=null,this.inputZoomObj=null,this.btnSaveObj=null,this.btnCancelObj=null,this.callbacks={init:null,zoom:{init:null,update:null},image:{success:null,error:null},save:{update_form_data:null,success:null,error:null},cancel:null,draw:null},this.errorLoadMessage="Could not load your image.\nUse png or jpg file.",this.errorUploadMessage="Could not upload your image.\nTry later.",this.canSave=!0,this.reader=new FileReader,this.reader.addEventListener("load",this.eventTreatImageListener),this.eventTreatImageOnLoad=this.treatImageOnLoad.bind(this),this.eventTreatImageOnError=this.treatImageOnError.bind(this),this.inProgress=!1},t.prototype.verifyMandatoryDataAttributes=function(t){var e=t.getAttribute("data-uploader-input_file-id");return this.inputFileObj=n("data-uploader-input_file-id",e),this.inputFileObj instanceof HTMLElement?(e=t.getAttribute("data-uploader-canvas-id"),this.canvasObj=n("data-uploader-canvas-id",e),this.canvasObj instanceof HTMLElement?null:this.canvasObj):this.inputFileObj},t.prototype.verifyOptionalDataAttributes=function(u){var t="",e=0,i="",s="",a=u.getAttribute("data-uploader-div_error-id")||null;if(null!==a&&(this.divErrorObj=n("data-uploader-div_error-id",a),!(this.divErrorObj instanceof HTMLElement)))return this.divErrorObj;if(null!==(a=u.getAttribute("data-uploader-div_upload-id")||null)&&(this.divUploadObj=n("data-uploader-div_upload-id",a),!(this.divUploadObj instanceof HTMLElement)))return this.divUploadObj;if(null!==(a=u.getAttribute("data-uploader-div_preview-id")||null)&&(this.divPreviewObj=n("data-uploader-div_preview-id",a),!(this.divPreviewObj instanceof HTMLElement)))return this.divPreviewObj;if(null!==(t=u.getAttribute("data-uploader-mask-size"))){if(t=-1===t.indexOf(",")?e=t>>0:(e=(a=t.split(","))[0]>>0,a[1]>>0),0===e||0==t)return new Error("Invalid attribute data-uploader-mask-size, expect size above 0, get width: "+e+" height: "+t);if(e>this.canvasObj.width||t>this.canvasObj.height)return new Error("Invalid attribute data-uploader-mask-size, expect size below canvas size, get width: "+e+" height: "+t);this.maskRaw.size={width:e,height:t}}if(null===(a=u.getAttribute("data-uploader-mask-color")))this.maskRaw.color="rgba(255, 255, 255, 0.5)";else{if(null===this.maskRaw.size)return new Error("Invalid attribute data-uploader-mask-color, you have to set data-uploader-mask-size first");this.maskRaw.color=a}if(null!==(e=u.getAttribute("data-uploader-mask-radius"))){if(null===this.maskRaw.size)return new Error("Invalid attribute data-uploader-mask-radius, you have to set data-uploader-mask-size first");this.maskRaw.radius=e>>0,0<this.maskRaw.radius&&(t=Math.min(this.maskRaw.size.width,this.maskRaw.size.height),this.maskRaw.radius>t)&&(this.maskRaw.radius=t/2>>0)}if(null!==(a=u.getAttribute("data-uploader-mask-constraint"))){if(null===this.maskRaw.size)return new Error("Invalid attribute data-uploader-mask-constraint, you have to set data-uploader-mask-size first");if("true"!==a&&"false"!==a)return new Error('Invalid attribute data-uploader-mask-constraint, expect value "true" or "false", get '+a);"false"===a&&(this.maskRaw.constraint=!1)}if(null!==(e=u.getAttribute("data-uploader-input_zoom-id"))&&(this.inputZoomObj=n("data-uploader-input_zoom-id",e),!(this.inputZoomObj instanceof HTMLElement)))return this.inputZoomObj;if(null!==(t=function t(e,i,s){var a,n,o=null,r=[],h=0,l=s.length;for(o in i)if(i.hasOwnProperty(o)){for(r=[],h=0;h<l;h++)r[h]=s;if(r.push(o),null===i[o]){if(null!==(a=u.getAttribute("data-uploader-callback-"+r.join("-"))||null)){if("function"!=typeof(n=function(){for(var t=window,e=a.split("."),i=0,s=e.length;i<s-1;i++)if("window"!==e[i]&&void 0===(t=t[e[i]]))return;return t[e[e.length-1]]}()))return new Error("Invalid function "+a+" in data-uploader-callback-"+r.join("-"));i[o]=n}}else if(null!==(n=t(e,i[o],r)))return n}return null}(this,this.callbacks,[])))return t;if(null!==(a=u.getAttribute("data-uploader-btn_save-id"))&&(this.btnSaveObj=n("data-uploader-btn_save-id",a),!(this.btnSaveObj instanceof HTMLElement)))return this.btnSaveObj;if(this.uploadUrl=u.getAttribute("data-uploader-upload-url")||window.location.toString(),this.uploadName=u.getAttribute("data-uploader-upload-name")||"image",this.uploadPrefix=u.getAttribute("data-uploader-upload-prefix")||"",null!==(e=u.getAttribute("data-uploader-btn_cancel-id"))&&(this.btnCancelObj=n("data-uploader-btn_cancel-id",e),!(this.btnCancelObj instanceof HTMLElement)))return this.btnCancelObj;if(0<(t=u.getAttribute("data-uploader-error-load")||"").length&&(this.errorLoadMessage=t),0<(a=u.getAttribute("data-uploader-error-upload")||"").length&&(this.errorUploadMessage=a),1.05===(i=u.getAttribute("data-uploader-scale_factor")||1.05)||0!==(i=parseFloat(i))&&!Number.isNaN(i)||(i=1.05),this.scaleFactor=i,""!==(s=u.getAttribute("data-uploader-css-canvas_moving")||"")){if(-1!==s.indexOf(" "))return new Error('Invalid css class "'+s+'" in data-uploader-css-canvas_moving, space is not allowed');this.cssClassCanvasMoving=s}return null},t.prototype.initInputFile=function(){this.inputFileObj.addEventListener("change",this.eventChangeInputFileListener)},t.prototype.initCanvas=function(){var r,h,t,e,i,s,a,n,l,o,u;this.lastX=this.canvasObj.width/2,this.lastY=this.canvasObj.height/2,this.canvasContext=this.canvasObj.getContext("2d"),this.canvasContext.imageSmoothingEnabled=!0,this.canvasContext.imageSmoothingQuality="high",r=this.canvasContext,h=d(),t=[],e=r.save,i=r.restore,s=r.scale,a=r.rotate,n=r.translate,l=r.transform,o=r.setTransform,u="function"!=typeof DOMPoint?document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGPoint():new DOMPoint,r.getTransform=function(){return h},r.save=function(){return t.push(h.translate(0,0)),e.call(r)},r.restore=function(){return h=t.pop(),i.call(r)},r.scale=function(t,e){return h=h.scale(t,e),s.call(r,t,e)},r.rotate=function(t){return h=h.rotate(180*t/Math.PI),a.call(r,t)},r.translate=function(t,e){return h=h.translate(t,e),n.call(r,t,e)},r.transform=function(t,e,i,s,a,n){var o=d();return o.a=t,o.b=e,o.c=i,o.d=s,o.e=a,o.f=n,h=h.multiply(o),l.call(r,t,e,i,s,a,n)},r.setTransform=function(t,e,i,s,a,n){return h.a=t,h.b=e,h.c=i,h.d=s,h.e=a,h.f=n,o.call(r,t,e,i,s,a,n)},r.transformedPoint=function(t,e){return u.x=t,u.y=e,u.matrixTransform(h.inverse())},this.eventMouseDownListener=this.moveStart.bind(this),this.eventMouseMoveListener=this.moveMove.bind(this),this.eventMouseUpListener=this.moveEnd.bind(this),this.eventTouchStartListener=this.moveStart.bind(this),this.eventTouchMoveListener=this.moveMove.bind(this),this.eventTouchEndListener=this.moveEnd.bind(this),this.eventHandleScrollListener=this.handleScroll.bind(this)},t.prototype.initDivs=function(){null!==this.divPreviewObj&&this.divPreviewObj.setAttribute("hidden",""),null!==this.divUploadObj&&this.divUploadObj.removeAttribute("hidden"),this.hideError()},t.prototype.initMask=function(){null!==this.maskRaw.size&&(this.mask={x:this.canvasObj.width/2-this.maskRaw.size.width/2,y:this.canvasObj.height/2-this.maskRaw.size.height/2,width:this.maskRaw.size.width,height:this.maskRaw.size.height,color:this.maskRaw.color,radius:this.maskRaw.radius,constraint:this.maskRaw.constraint})},t.prototype.initZoom=function(){null!==this.inputZoomObj&&(this.inputZoomObj.addEventListener("input",this.eventInputInputZoomListener),this.inputZoomObj.addEventListener("change",this.eventChangeInputZoomListener)),null!==this.callbacks.zoom.init&&this.callbacks.zoom.init(this,"initZoom")},t.prototype.initSave=function(){null!==this.btnSaveObj&&this.btnSaveObj.addEventListener("click",this.eventSaveListener)},t.prototype.initCancel=function(){null!==this.btnCancelObj&&this.btnCancelObj.addEventListener("click",this.eventCancelListener)},t.prototype.changeInputFile=function(){this.inputFileObj.files.length<1||this.reader.readAsDataURL(this.inputFileObj.files[0])},t.prototype.treatImage=function(){this.img=new Image,this.img.onload=this.eventTreatImageOnLoad,this.img.onerror=this.eventTreatImageOnError,this.img.src=this.reader.result},t.prototype.treatImageOnLoad=function(){this.img.width<=0||this.img.height<=0?this.treatImageOnError():(this.removeEventListeners(),this.addEventListeners(),this.zoomCurrent=1,this.inputZoomObj&&(this.inputZoomObj.value=1),this.canvasContext.setTransform(1,0,0,1,0,0),this.computeSize(),this.draw(),this.divUploadObj&&this.divUploadObj.setAttribute("hidden",""),this.divPreviewObj&&this.divPreviewObj.removeAttribute("hidden"),this.hideError(),null!==this.callbacks.image.success&&this.callbacks.image.success(this,"treatImageOnLoad"),null!==this.callbacks.zoom.update&&this.callbacks.zoom.update(this,"treatImageOnLoad"))},t.prototype.treatImageOnError=function(){this.img=null,this.clearCanvas(),this.showError(this.errorLoadMessage),null!==this.callbacks.image.error&&this.callbacks.image.error(this,"treatImageOnError")},t.prototype.addEventListeners=function(){this.canvasObj.addEventListener("mousedown",this.eventMouseDownListener,{passive:!1}),window.addEventListener("mousemove",this.eventMouseMoveListener,{passive:!1}),window.addEventListener("mouseup",this.eventMouseUpListener,{passive:!1}),this.canvasObj.addEventListener("touchstart",this.eventTouchStartListener,{passive:!1}),this.canvasObj.addEventListener("touchmove",this.eventTouchMoveListener,{passive:!1}),this.canvasObj.addEventListener("touchend",this.eventTouchEndListener,{passive:!1}),this.canvasObj.addEventListener("DOMMouseScroll",this.eventHandleScrollListener,{passive:!1}),this.canvasObj.addEventListener("mousewheel",this.eventHandleScrollListener,{passive:!1})},t.prototype.removeEventListeners=function(){this.canvasObj.removeEventListener("mousedown",this.eventMouseDownListener),window.removeEventListener("mousemove",this.eventMouseMoveListener),window.removeEventListener("mouseup",this.eventMouseUpListener),this.canvasObj.removeEventListener("touchstart",this.eventTouchStartListener),this.canvasObj.removeEventListener("touchmove",this.eventTouchMoveListener),this.canvasObj.removeEventListener("touchend",this.eventTouchEndListener),this.canvasObj.removeEventListener("DOMMouseScroll",this.eventHandleScrollListener),this.canvasObj.removeEventListener("mousewheel",this.eventHandleScrollListener)},t.prototype.cancel=function(){this.img=null,this.imgSizeComputed=null,this.zoomCurrent=1,null!==this.divPreviewObj&&this.divPreviewObj.setAttribute("hidden",""),null!==this.divUploadObj&&this.divUploadObj.removeAttribute("hidden"),this.hideError(),this.clearCanvas(),this.inputFileObj.value=null,this.removeEventListeners(),null!==this.callbacks.cancel&&this.callbacks.cancel(this,"cancel")},t.prototype.save=function(){var t,e=null,i=null;null!==this.img&&!1!==this.canSave&&(this.canSave=!1,t=function(t){for(var e="",i=null,s=0,e=(0<=t.split(",")[0].indexOf("base64")?atob:decodeURI)(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),n=e.length;s<n;++s)i[s]=e.charCodeAt(s);return new Blob([i],{type:a})}(this.getCanvasDataURL()),(e=new FormData).append(this.uploadPrefix+this.uploadName,t),e.append(this.uploadPrefix+"canvas_width",this.canvasObj.width),e.append(this.uploadPrefix+"canvas_height",this.canvasObj.height),null!==this.mask&&(e.append(this.uploadPrefix+"mask_width",this.mask.width),e.append(this.uploadPrefix+"mask_height",this.mask.height),e.append(this.uploadPrefix+"mask_x",this.mask.x),e.append(this.uploadPrefix+"mask_y",this.mask.y)),null!==this.callbacks.save.update_form_data&&(e=this.callbacks.save.update_form_data(this,"save",e)),(i=new XMLHttpRequest).addEventListener("load",this.eventSaveOnLoad),i.addEventListener("error",this.eventSaveOnError),i.open("POST",this.uploadUrl),i.send(e))},t.prototype.saveOnLoad=function(){this.canSave=!0,this.hideError(),null!==this.callbacks.save.success&&this.callbacks.save.success(this,"saveOnLoad")},t.prototype.saveOnError=function(t){this.canSave=!0,this.showError(this.errorUploadMessage),null!==this.callbacks.save.error&&this.callbacks.save.error(this,"saveOnError",t)},t.prototype.computeSize=function(){var t,e={x:0,y:0,width:this.canvasObj.width,height:this.canvasObj.height};return null!==this.mask&&(e.x=this.mask.x,e.y=this.mask.y,e.width=this.mask.width,e.height=this.mask.height),this.imgSizeComputed={x:e.x,y:e.y,width:e.width,height:e.height},t=Math.max(e.width/this.img.width,e.height/this.img.height),this.imgSizeComputed.height=this.img.height*t,this.imgSizeComputed.width=this.img.width*t,this.imgSizeComputed.x=e.x-(this.imgSizeComputed.width/2-e.width/2),this.imgSizeComputed.y=e.y-(this.imgSizeComputed.height/2-e.height/2),this.imgSizeComputed},t.prototype.draw=function(){this.clearCanvas(),this.drawImage(),this.drawMask(),null!==this.mask&&(this.ptTopLeftMask=this.canvasContext.transformedPoint(this.mask.x,this.mask.y),this.ptBottomRightMask=this.canvasContext.transformedPoint(this.mask.x+this.mask.width,this.mask.y+this.mask.height)),null!==this.callbacks.draw&&this.callbacks.draw(this,"draw")},t.prototype.clearCanvas=function(){var t=this.canvasContext.transformedPoint(0,0),e=this.canvasContext.transformedPoint(this.canvasObj.width,this.canvasObj.height);this.canvasContext.clearRect(t.x,t.y,e.x-t.x,e.y-t.y)},t.prototype.drawImage=function(){this.canvasContext.drawImage(this.img,this.imgSizeComputed.x,this.imgSizeComputed.y,this.imgSizeComputed.width,this.imgSizeComputed.height)},t.prototype.drawMask=function(){var t,e,i,s,a,n,o,r;null!==this.mask&&(this.canvasContext.save(),this.canvasContext.setTransform(1,0,0,1,0,0),this.canvasContext.fillStyle=this.mask.color,this.canvasContext.beginPath(),t=this.mask.x,e=this.mask.y,i=this.mask.width,s=this.mask.height,a=this.mask.radius,n=this.mask.radius,o=this.mask.radius,r=this.mask.radius,this.canvasContext.moveTo(t+a,e),this.canvasContext.lineTo(t+i-n,e),this.canvasContext.quadraticCurveTo(t+i,e,t+i,e+n),this.canvasContext.lineTo(t+i,e+s-o),this.canvasContext.quadraticCurveTo(t+i,e+s,t+i-o,e+s),this.canvasContext.lineTo(t+r,e+s),this.canvasContext.quadraticCurveTo(t,e+s,t,e+s-r),this.canvasContext.lineTo(t,e+a),this.canvasContext.quadraticCurveTo(t,e,t+a,e),this.canvasContext.closePath(),this.canvasContext.rect(this.canvasObj.width,0,-this.canvasObj.width,this.canvasObj.height),this.canvasContext.fill(),this.canvasContext.restore())},t.prototype.getCanvasDataURL=function(){var t;return null===this.mask?this.canvasObj.toDataURL():(this.clearCanvas(),this.drawImage(),t=this.canvasObj.toDataURL(),this.drawMask(),t)},t.prototype.moveStart=function(t){o(t),t.touches&&0<t.touches.length?(this.lastX=t.touches[0].pageX,this.lastY=t.touches[0].pageY):(this.lastX=t.pageX,this.lastY=t.pageY),this.dragStart={x:this.lastX,y:this.lastY},""!==this.cssClassCanvasMoving&&this.canvasObj.classList.add(this.cssClassCanvasMoving)},t.prototype.moveMove=function(t){var e;this.dragStart&&(t.touches&&0<t.touches.length?(this.lastX=t.touches[0].pageX,this.lastY=t.touches[0].pageY):(this.lastX=t.pageX,this.lastY=t.pageY),o(t),this.lastX===this.dragStart.x&&this.lastY===this.dragStart.y||(e=this.canvasContext.getTransform().inverse().a,0===(e=this.keepImgInsideMaskBoundings({x:(this.lastX-this.dragStart.x)*e,y:(this.lastY-this.dragStart.y)*e})).x&&0===e.y||(this.canvasContext.translate(e.x,e.y),this.draw()),this.dragStart.x=this.lastX,this.dragStart.y=this.lastY))},t.prototype.moveEnd=function(){var t;this.dragStart=null,""!==this.cssClassCanvasMoving&&this.canvasObj.classList.remove(this.cssClassCanvasMoving),0===(t=this.keepImgInsideMaskBoundings({x:0,y:0})).x&&0===t.y||(this.canvasContext.translate(t.x,t.y),this.draw())},t.prototype.keepImgInsideMaskBoundings=function(t){return null!==this.mask&&!1!==this.mask.constraint&&(this.imgSizeComputed.x>this.ptTopLeftMask.x?t.x=this.ptTopLeftMask.x-this.imgSizeComputed.x:this.ptTopLeftMask.x===this.imgSizeComputed.x&&0<t.x&&(t.x=0),this.imgSizeComputed.y>this.ptTopLeftMask.y?t.y=this.ptTopLeftMask.y-this.imgSizeComputed.y:this.ptTopLeftMask.y===this.imgSizeComputed.y&&0<t.y&&(t.y=0),this.ptBottomRightMask.x>this.imgSizeComputed.x+this.imgSizeComputed.width?t.x=this.ptBottomRightMask.x-(this.imgSizeComputed.x+this.imgSizeComputed.width):this.ptBottomRightMask.x===this.imgSizeComputed.x+this.imgSizeComputed.width&&t.x<0&&(t.x=0),this.ptBottomRightMask.y>this.imgSizeComputed.y+this.imgSizeComputed.height?t.y=this.ptBottomRightMask.y-(this.imgSizeComputed.y+this.imgSizeComputed.height):this.ptBottomRightMask.y===this.imgSizeComputed.y+this.imgSizeComputed.height&&t.y<0&&(t.y=0)),t},t.prototype.updateZoomFromInput=function(t){var e,i,s,a=0;if(null!==this.img){if(this.inProgress)return t.preventDefault(),!1;for(this.inProgress=!0,e=this.canvasContext.transformedPoint(this.canvasObj.width/2,this.canvasObj.height/2),s=0<(a=this.zoomCurrent-t.target.value)?Math.pow(this.scaleFactor,-1):Math.pow(this.scaleFactor,1);0!==a;){if(0<a){if(1===this.zoomCurrent)break;--this.zoomCurrent,--a}else this.zoomCurrent+=1,a+=1;this.canvasContext.translate(e.x,e.y),this.canvasContext.scale(s,s),this.canvasContext.translate(-e.x,-e.y)}i=this.keepImgInsideMaskBoundings({x:0,y:0}),this.canvasContext.translate(i.x,i.y),this.draw(),null!==this.callbacks.zoom.update&&this.callbacks.zoom.update(this,"updateZoomFromInput"),this.inProgress=!1}},t.prototype.inputInputZoomListener=function(t){this.zoomEventHasNeverFired=1,this.zoomCurrentValue=t.target.value,this.zoomCurrentValue!==this.zoomLastValue&&this.updateZoomFromInput(t),this.zoomLastValue=this.zoomCurrentValue},t.prototype.changeInputZoomListener=function(t){this.zoomEventHasNeverFired||this.updateZoomFromInput(t)},t.prototype.zoomIn=function(t){this.zoomCurrent+=1,this.zoom(1,t)},t.prototype.zoomOut=function(t){1!==this.zoomCurrent&&(--this.zoomCurrent,this.zoom(-1,t))},t.prototype.zoom=function(t,e){var i,s="center"===e?this.canvasContext.transformedPoint(this.canvasObj.width/2,this.canvasObj.height/2):this.canvasContext.transformedPoint(this.lastX,this.lastY);this.canvasContext.translate(s.x,s.y),i=Math.pow(this.scaleFactor,t),this.canvasContext.scale(i,i),this.canvasContext.translate(-s.x,-s.y),i=this.keepImgInsideMaskBoundings({x:0,y:0}),this.canvasContext.translate(i.x,i.y),this.draw()},t.prototype.handleScroll=function(t){var e,i=this.lastX,s=this.lastY;return this.lastX=t.offsetX||t.pageX-this.canvasObj.offsetLeft,this.lastY=t.offsetY||t.pageY-this.canvasObj.offsetTop,1==(e=0<t.detail||t.wheelDelta<0?-1:1)?this.zoomIn(a):-1==e&&this.zoomOut(a),null!==this.inputZoomObj&&(this.inputZoomObj.value=this.zoomCurrent),null!==this.callbacks.zoom.update&&this.callbacks.zoom.update(this,"handleScroll"),this.lastX=i,this.lastY=s,o(t),!1},t.prototype.showError=function(t){var e,i,s=0;if(null!==this.divErrorObj){for(;this.divErrorObj.lastChild;)this.divErrorObj.lastChild.remove();for(i=(e=t.split("\n")).length;s<i;++s)this.divErrorObj.appendChild(document.createTextNode(e[s])),s+1<i&&this.divErrorObj.appendChild(document.createElement("br"));this.divErrorObj.removeAttribute("hidden")}},t.prototype.hideError=function(){if(null!==this.divErrorObj)for(this.divErrorObj.setAttribute("hidden","");this.divErrorObj.lastChild;)this.divErrorObj.lastChild.remove()},window.Uploader=t}();